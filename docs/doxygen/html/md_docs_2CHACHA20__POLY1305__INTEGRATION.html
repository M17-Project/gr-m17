<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GNU Radio M17 Module: ChaCha20-Poly1305 Integration for M17</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">GNU Radio M17 Module<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">M17 digital radio protocol with AX.25 TNC KISS support</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">ChaCha20-Poly1305 Integration for M17</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Overview</h1>
<p>This document describes the integration of ChaCha20-Poly1305 authenticated encryption as an optional alternative to AES-GCM in the M17 digital radio protocol. ChaCha20-Poly1305 provides high-performance, secure encryption with excellent performance on both x86_64 and ARM architectures.</p>
<h1>Features</h1>
<h2>Cryptographic Security</h2>
<ul>
<li><b>ChaCha20 Stream Cipher</b>: 256-bit key, 96-bit IV, 32-bit counter</li>
<li><b>Poly1305 Authentication</b>: 128-bit authentication tag</li>
<li><b>RFC 8439 Compliance</b>: Full compliance with the ChaCha20-Poly1305 standard</li>
<li><b>OpenSSL Integration</b>: Uses OpenSSL's optimized ChaCha20-Poly1305 implementation</li>
</ul>
<h2>Performance Benefits</h2>
<ul>
<li><b>ARM Optimization</b>: Excellent performance on ARM Cortex-A55 (MCM-iMX93)</li>
<li><b>SIMD Acceleration</b>: Leverages ARM NEON instructions when available</li>
<li><b>Memory Efficiency</b>: Lower memory footprint compared to AES-GCM</li>
<li><b>Parallel Processing</b>: ChaCha20 is highly parallelizable</li>
</ul>
<h2>Security Features</h2>
<ul>
<li><b>Authenticated Encryption</b>: Provides both confidentiality and authenticity</li>
<li><b>Nonce Reuse Protection</b>: Secure IV generation prevents nonce reuse attacks</li>
<li><b>Key Validation</b>: Weak key detection and validation</li>
<li><b>Secure Memory</b>: <code>explicit_bzero()</code> for secure key wiping</li>
</ul>
<h1>Implementation</h1>
<h2>Core Functions</h2>
<h3>Encryption</h3>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> m17_chacha20_poly1305_encrypt(</div>
<div class="line"> <span class="keyword">const</span> uint8_t* plaintext, <span class="keywordtype">size_t</span> plaintext_len,</div>
<div class="line"> <span class="keyword">const</span> uint8_t* key, <span class="keywordtype">size_t</span> key_size,</div>
<div class="line"> <span class="keyword">const</span> uint8_t* iv, <span class="keywordtype">size_t</span> iv_size,</div>
<div class="line"> <span class="keyword">const</span> uint8_t* aad, <span class="keywordtype">size_t</span> aad_len,</div>
<div class="line"> uint8_t* ciphertext, <span class="keywordtype">size_t</span> ciphertext_size,</div>
<div class="line"> uint8_t* tag, <span class="keywordtype">size_t</span> tag_size</div>
<div class="line">);</div>
</div><!-- fragment --><h3>Decryption</h3>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> m17_chacha20_poly1305_decrypt(</div>
<div class="line"> <span class="keyword">const</span> uint8_t* ciphertext, <span class="keywordtype">size_t</span> ciphertext_len,</div>
<div class="line"> <span class="keyword">const</span> uint8_t* key, <span class="keywordtype">size_t</span> key_size,</div>
<div class="line"> <span class="keyword">const</span> uint8_t* iv, <span class="keywordtype">size_t</span> iv_size,</div>
<div class="line"> <span class="keyword">const</span> uint8_t* aad, <span class="keywordtype">size_t</span> aad_len,</div>
<div class="line"> <span class="keyword">const</span> uint8_t* tag, <span class="keywordtype">size_t</span> tag_size,</div>
<div class="line"> uint8_t* plaintext, <span class="keywordtype">size_t</span> plaintext_size</div>
<div class="line">);</div>
</div><!-- fragment --><h2>Key Management</h2>
<h3>Key Generation</h3>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> m17_chacha20_generate_key(uint8_t* key, <span class="keywordtype">size_t</span> key_size);</div>
<div class="line"><span class="keywordtype">int</span> m17_chacha20_generate_iv(uint8_t* iv, <span class="keywordtype">size_t</span> iv_size);</div>
</div><!-- fragment --><h3>Key Derivation</h3>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> m17_chacha20_derive_key(</div>
<div class="line"> <span class="keyword">const</span> uint8_t* shared_secret, <span class="keywordtype">size_t</span> secret_size,</div>
<div class="line"> <span class="keyword">const</span> uint8_t* salt, <span class="keywordtype">size_t</span> salt_size,</div>
<div class="line"> <span class="keyword">const</span> uint8_t* info, <span class="keywordtype">size_t</span> info_len,</div>
<div class="line"> uint8_t* derived_key, <span class="keywordtype">size_t</span> key_size</div>
<div class="line">);</div>
</div><!-- fragment --><h3>Validation</h3>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> m17_chacha20_validate_key(<span class="keyword">const</span> uint8_t* key, <span class="keywordtype">size_t</span> key_size);</div>
<div class="line"><span class="keywordtype">int</span> m17_chacha20_validate_iv(<span class="keyword">const</span> uint8_t* iv, <span class="keywordtype">size_t</span> iv_size);</div>
</div><!-- fragment --><h2>GNU Radio Integration</h2>
<h3>C++ Interface</h3>
<div class="fragment"><div class="line"><span class="keyword">class </span>m17_coder_impl {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> <span class="comment">// ChaCha20-Poly1305 encryption</span></div>
<div class="line"> <span class="keywordtype">int</span> encrypt_chacha20_poly1305(</div>
<div class="line"> <span class="keyword">const</span> uint8_t* plaintext, <span class="keywordtype">size_t</span> plaintext_len,</div>
<div class="line"> <span class="keyword">const</span> uint8_t* key, <span class="keywordtype">size_t</span> key_size,</div>
<div class="line"> <span class="keyword">const</span> uint8_t* iv, <span class="keywordtype">size_t</span> iv_size,</div>
<div class="line"> <span class="keyword">const</span> uint8_t* aad, <span class="keywordtype">size_t</span> aad_len,</div>
<div class="line"> uint8_t* ciphertext, <span class="keywordtype">size_t</span> ciphertext_size,</div>
<div class="line"> uint8_t* tag, <span class="keywordtype">size_t</span> tag_size</div>
<div class="line"> );</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// ChaCha20-Poly1305 decryption</span></div>
<div class="line"> <span class="keywordtype">int</span> decrypt_chacha20_poly1305(</div>
<div class="line"> <span class="keyword">const</span> uint8_t* ciphertext, <span class="keywordtype">size_t</span> ciphertext_len,</div>
<div class="line"> <span class="keyword">const</span> uint8_t* key, <span class="keywordtype">size_t</span> key_size,</div>
<div class="line"> <span class="keyword">const</span> uint8_t* iv, <span class="keywordtype">size_t</span> iv_size,</div>
<div class="line"> <span class="keyword">const</span> uint8_t* aad, <span class="keywordtype">size_t</span> aad_len,</div>
<div class="line"> <span class="keyword">const</span> uint8_t* tag, <span class="keywordtype">size_t</span> tag_size,</div>
<div class="line"> uint8_t* plaintext, <span class="keywordtype">size_t</span> plaintext_size</div>
<div class="line"> );</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Key management</span></div>
<div class="line"> <span class="keywordtype">bool</span> set_chacha20_key(<span class="keyword">const</span> std::string&amp; hex_key);</div>
<div class="line"> <span class="keywordtype">bool</span> set_chacha20_iv(<span class="keyword">const</span> std::string&amp; hex_iv);</div>
<div class="line"> <span class="keywordtype">void</span> generate_chacha20_iv();</div>
<div class="line"> <span class="keywordtype">bool</span> is_chacha20_available() <span class="keyword">const</span>;</div>
<div class="line">};</div>
</div><!-- fragment --><h1>Usage Examples</h1>
<h2>Basic Encryption/Decryption</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;m17.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* message = <span class="stringliteral">&quot;Hello, M17!&quot;</span>;</div>
<div class="line"> <span class="keywordtype">size_t</span> message_len = strlen(message);</div>
<div class="line"> </div>
<div class="line"> uint8_t key[32];</div>
<div class="line"> uint8_t iv[12];</div>
<div class="line"> uint8_t ciphertext[256];</div>
<div class="line"> uint8_t tag[16];</div>
<div class="line"> uint8_t decrypted[256];</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Generate key and IV</span></div>
<div class="line"> m17_chacha20_generate_key(key, <span class="keyword">sizeof</span>(key));</div>
<div class="line"> m17_chacha20_generate_iv(iv, <span class="keyword">sizeof</span>(iv));</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Encrypt</span></div>
<div class="line"> <span class="keywordtype">int</span> ciphertext_len = m17_chacha20_poly1305_encrypt(</div>
<div class="line"> (uint8_t*)message, message_len,</div>
<div class="line"> key, <span class="keyword">sizeof</span>(key),</div>
<div class="line"> iv, <span class="keyword">sizeof</span>(iv),</div>
<div class="line"> NULL, 0, <span class="comment">// No AAD</span></div>
<div class="line"> ciphertext, <span class="keyword">sizeof</span>(ciphertext),</div>
<div class="line"> tag, <span class="keyword">sizeof</span>(tag)</div>
<div class="line"> );</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Decrypt</span></div>
<div class="line"> <span class="keywordtype">int</span> decrypted_len = m17_chacha20_poly1305_decrypt(</div>
<div class="line"> ciphertext, ciphertext_len,</div>
<div class="line"> key, <span class="keyword">sizeof</span>(key),</div>
<div class="line"> iv, <span class="keyword">sizeof</span>(iv),</div>
<div class="line"> NULL, 0, <span class="comment">// No AAD</span></div>
<div class="line"> tag, <span class="keyword">sizeof</span>(tag),</div>
<div class="line"> decrypted, <span class="keyword">sizeof</span>(decrypted)</div>
<div class="line"> );</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Verify</span></div>
<div class="line"> <span class="keywordflow">if</span> (decrypted_len == (<span class="keywordtype">int</span>)message_len &amp;&amp; </div>
<div class="line"> memcmp(message, decrypted, message_len) == 0) {</div>
<div class="line"> printf(<span class="stringliteral">&quot;SUCCESS: Message encrypted and decrypted correctly\n&quot;</span>);</div>
<div class="line"> }</div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h2>GNU Radio C++ Usage</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;m17_coder_impl.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create M17 coder</span></div>
<div class="line">m17_coder_impl encoder(<span class="stringliteral">&quot;N0CALL&quot;</span>, <span class="stringliteral">&quot;W1ABC&quot;</span>, 1, 0, 0, 0, 0, 0, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set ChaCha20 key</span></div>
<div class="line">std::string hex_key = <span class="stringliteral">&quot;a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456&quot;</span>;</div>
<div class="line">encoder.set_chacha20_key(hex_key);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Generate IV</span></div>
<div class="line">encoder.generate_chacha20_iv();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check availability</span></div>
<div class="line"><span class="keywordflow">if</span> (encoder.is_chacha20_available()) {</div>
<div class="line"> printf(<span class="stringliteral">&quot;ChaCha20-Poly1305 is available\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><h1>Protocol Integration</h1>
<h2>M17 Frame Format</h2>
<p>ChaCha20-Poly1305 is integrated as an extended encryption mode in M17:</p>
<div class="fragment"><div class="line">LSF TYPE Field:</div>
<div class="line">- Bits 11-9: Encryption type</div>
<div class="line"> - 000: No encryption (M17 standard)</div>
<div class="line"> - 010: AES encryption (M17 standard)</div>
<div class="line"> - 100: ChaCha20-Poly1305 (extended mode)</div>
</div><!-- fragment --><h2>Frame Structure</h2>
<div class="fragment"><div class="line">M17 Frame with ChaCha20-Poly1305:</div>
<div class="line"> </div>
<div class="line"> Sync Word LSF (Link Payload Auth Tag </div>
<div class="line"> (8 symbols) Setup Frame) (encrypted) (16 bytes) </div>
</div><!-- fragment --><h2>AAD (Additional Authenticated Data)</h2>
<p>The M17 LSF (Link Setup Frame) is used as AAD for authentication:</p>
<div class="fragment"><div class="line"><span class="comment">// Use LSF as AAD</span></div>
<div class="line">uint8_t* aad = (uint8_t*)&amp;lsf;</div>
<div class="line"><span class="keywordtype">size_t</span> aad_len = <span class="keyword">sizeof</span>(lsf);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Encrypt payload with LSF as AAD</span></div>
<div class="line"><span class="keywordtype">int</span> result = m17_chacha20_poly1305_encrypt(</div>
<div class="line"> payload, payload_len,</div>
<div class="line"> key, <span class="keyword">sizeof</span>(key),</div>
<div class="line"> iv, <span class="keyword">sizeof</span>(iv),</div>
<div class="line"> aad, aad_len,</div>
<div class="line"> ciphertext, ciphertext_size,</div>
<div class="line"> tag, <span class="keyword">sizeof</span>(tag)</div>
<div class="line">);</div>
</div><!-- fragment --><h1>Security Considerations</h1>
<h2>Key Management</h2>
<ul>
<li><b>Key Generation</b>: Use cryptographically secure random number generation</li>
<li><b>Key Storage</b>: Store keys securely, use hardware security modules when available</li>
<li><b>Key Rotation</b>: Implement regular key rotation for long-term security</li>
<li><b>Key Derivation</b>: Use HKDF for deriving keys from shared secrets</li>
</ul>
<h2>IV Management</h2>
<ul>
<li><b>Uniqueness</b>: Each encryption must use a unique IV</li>
<li><b>Randomness</b>: Use cryptographically secure random number generation</li>
<li><b>Nonce Reuse</b>: Never reuse IVs with the same key</li>
<li><b>IV Length</b>: Use 96-bit (12-byte) IVs as recommended by RFC 8439</li>
</ul>
<h2>Authentication</h2>
<ul>
<li><b>Tag Verification</b>: Always verify authentication tags before processing</li>
<li><b>AAD Integrity</b>: Ensure AAD (LSF) is not modified between encryption and decryption</li>
<li><b>Timing Attacks</b>: Use constant-time comparison for tag verification</li>
</ul>
<h1>Performance Characteristics</h1>
<h2>ARM Cortex-A55 (MCM-iMX93)</h2>
<ul>
<li><b>Encryption Speed</b>: ~200 MB/s on ARM Cortex-A55</li>
<li><b>Memory Usage</b>: ~2KB per encryption context</li>
<li><b>Power Efficiency</b>: Lower power consumption than AES-GCM</li>
<li><b>SIMD Acceleration</b>: 2-4x speedup with NEON instructions</li>
</ul>
<h2>x86_64</h2>
<ul>
<li><b>Encryption Speed</b>: ~500 MB/s on modern x86_64</li>
<li><b>AVX2 Acceleration</b>: 3-5x speedup with AVX2 instructions</li>
<li><b>Memory Bandwidth</b>: Lower memory bandwidth requirements than AES-GCM</li>
</ul>
<h1>Testing</h1>
<h2>Test Suite</h2>
<div class="fragment"><div class="line"># Build and run ChaCha20-Poly1305 tests</div>
<div class="line">cd libm17</div>
<div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake ..</div>
<div class="line">make test_chacha20_poly1305</div>
<div class="line">./test_chacha20_poly1305</div>
</div><!-- fragment --><h2>Test Coverage</h2>
<ul>
<li>Basic encryption/decryption</li>
<li>Different message sizes (1 byte to 1KB)</li>
<li>Authentication failure detection</li>
<li>Key and IV validation</li>
<li>Key derivation</li>
<li>Memory management</li>
</ul>
<h1>Compatibility</h1>
<h2>M17 Standard Compliance</h2>
<ul>
<li><b>Extended Mode</b>: ChaCha20-Poly1305 is an extended encryption mode</li>
<li><b>Backward Compatibility</b>: Standard M17 receivers cannot decode ChaCha20-Poly1305 frames</li>
<li><b>Coordination Required</b>: Both transmitter and receiver must support ChaCha20-Poly1305</li>
</ul>
<h2>Hardware Requirements</h2>
<ul>
<li><b>OpenSSL</b>: Requires OpenSSL 1.1.1+ for ChaCha20-Poly1305 support</li>
<li><b>ARM NEON</b>: Optional SIMD acceleration on ARM processors</li>
<li><b>x86 AVX2</b>: Optional SIMD acceleration on x86_64 processors</li>
</ul>
<h1>Future Enhancements</h1>
<h2>Planned Features</h2>
<ul>
<li><b>Hardware Acceleration</b>: Integration with ARM CryptoCell</li>
<li><b>Key Exchange</b>: X25519 key exchange for ChaCha20 keys</li>
<li><b>Perfect Forward Secrecy</b>: Ephemeral key generation</li>
<li><b>Multi-receiver</b>: Group encryption with multiple recipients</li>
</ul>
<h2>Research Areas</h2>
<ul>
<li><b>Post-Quantum</b>: Integration with post-quantum cryptography</li>
<li><b>Zero-Knowledge</b>: Zero-knowledge proof integration</li>
<li><b>Homomorphic</b>: Homomorphic encryption for secure processing</li>
</ul>
<h1>References</h1>
<ul>
<li><a href="https://tools.ietf.org/html/rfc8439">RFC 8439: ChaCha20 and Poly1305 for IETF Protocols</a></li>
<li><a href="https://tools.ietf.org/html/draft-irtf-cfrg-chacha20-poly1305">ChaCha20 and Poly1305 for IETF Protocols</a></li>
<li><a href="https://www.openssl.org/docs/man1.1.1/man3/EVP_chacha20_poly1305.html">OpenSSL ChaCha20-Poly1305 Documentation</a></li>
<li><a href="https://spec.m17project.org/">M17 Protocol Specification</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
